angular.module("sbDateSelect",[]).directive("sbDateSelect",[function(){return{restrict:"A",replace:!0,template:['<div class="sb-date-select">','<select class="sb-date-select-day" ng-model="val.date", ng-options="d for d in dates">',"<option value disabled selected>Day</option>","</select>",'<select class="sb-date-select-month" ng-model="val.month", ng-options="m.value as m.name for m in months">',"<option value disabled>Month</option>","</select>",'<select class="sb-date-select-day" ng-model="val.year" ng-options="y for y in years">',"<option value disabled selected>Year</option>","</select>","</div>"].join(""),require:"ngModel",scope:!0,link:function(e,a,t,l){function n(){e.months=[];for(var a=e.val.year&&s.isSame([e.val.year],"year")?s.month():0,t=e.val.year&&m.isSame([e.val.year],"year")?m.month():11,l=moment.months(),n=a;n<=t;n++)e.months.push({name:l[n],value:n+1});(e.val.month-1>t||e.val.month-1<a)&&delete e.val.month}function o(a,t){var l,n;l=e.val.year&&e.val.month&&s.isSame([e.val.year,e.val.month-1],"month")?s.date():1,n=e.val.year&&e.val.month&&m.isSame([e.val.year,e.val.month-1],"month")?m.date():e.val.year&&e.val.month?moment([e.val.year,e.val.month-1]).daysInMonth():31,e.dates=[];for(var o=l;o<=n;o++)e.dates.push(o);e.val.date>e.dates.length&&delete e.val.date}e.val={};var s=e.min=moment(t.min||"1900-01-01"),m=e.max=moment(t.max);e.years=[];for(var v=m.years();v>=s.years();v--)e.years.push(v);e.$watch("val.year",function(){n()}),e.$watchCollection("[val.month, val.year]",function(){o()}),e.$watchCollection("[val.date, val.month, val.year]",function(){if(e.val.year&&e.val.month&&e.val.date){var a=moment([e.val.year,e.val.month-1,e.val.date]);l.$setViewValue(a.format("YYYY-MM-DD"))}else l.$setViewValue()}),l.$render=function(){if(l.$viewValue){var a=moment(l.$viewValue);e.val={year:a.year(),month:a.month()+1,date:a.date()}}}}}}]);
